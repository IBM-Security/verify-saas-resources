<?xml version="1.0" encoding="UTF-8"?><bpmn2:definitions xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" exporter="Camunda Modeler" exporterVersion="5.0.0" id="_FXeIoKhnEeOC4LOKh_69JQ" targetNamespace="isv_customtasks" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:isv="http://ibm.com/bpmn/isv" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd"><bpmn2:process camunda:historyTimeToLive="1" id="identity_source_routing" isExecutable="true" name="Identity Source Routing"><bpmn2:startEvent id="Event_0onayf9"><bpmn2:outgoing>Flow_1w02h0s</bpmn2:outgoing></bpmn2:startEvent><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.RenderHTMLTask" id="isv_render_html_1693487581300_customId" name="Ask Username"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter attrDisplayText="themeRegistrations.name" attrId="themeRegistrations.id" defaultValue="default" displayName="Theme" endpoint="/v1.0/branding/themes" id="themeId" inputType="SingleSelect" instruction="Name of the theme to render" method="GET" name="themeId" order="1" placeholder="Select a theme" required="true" type="String">c5fdcfd2-6558-4be8-80ba-915b9a1ac2c9</isv:inputParameter><isv:inputParameter attrDisplayText="templateList.name" attrId="templateList.name" defaultValue="custom_page1" displayName="Template name" endpoint="/bpm-mgmt/v1.0/customtask/util/templateList" id="templatename" inputType="SingleSelect" instruction="Name of the template to render" method="GET" name="templateName" order="2" placeholder="Select a template" required="true" type="String">custom_page1</isv:inputParameter><isv:inputParameter displayName="Signal(optional)" id="signal" instruction="Signal that an existing flow can use to come back and resume it's task." name="signal" order="3" type="String">ifa</isv:inputParameter></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_1w02h0s</bpmn2:incoming><bpmn2:outgoing>Flow_0x5fq5m</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:sequenceFlow id="Flow_1w02h0s" sourceRef="Event_0onayf9" targetRef="isv_render_html_1693487581300_customId"/><bpmn2:intermediateCatchEvent id="Event_0vtdtpv_customId"><bpmn2:incoming>Flow_0x5fq5m</bpmn2:incoming><bpmn2:outgoing>Flow_1n6t15u</bpmn2:outgoing><bpmn2:messageEventDefinition id="MessageEventDefinition_1potozk" messageRef="Message_08k7kfh"/></bpmn2:intermediateCatchEvent><bpmn2:endEvent id="Event_0fzzuo8_customId"><bpmn2:incoming>Flow_0j7k9ud</bpmn2:incoming><bpmn2:incoming>Flow_14jmad3</bpmn2:incoming></bpmn2:endEvent><bpmn2:sequenceFlow id="Flow_0x5fq5m" sourceRef="isv_render_html_1693487581300_customId" targetRef="Event_0vtdtpv_customId"/><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.FetchUserTask" id="isv_fetch_user_1693487617442_customId" name="Get User Details"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter displayName="User name" id="userid" instruction="Name of the user to search on" name="userid" order="1" type="String">${S(workflow_context).prop("username").value()}</isv:inputParameter><isv:outputParameter displayName="User details" id="user" instruction="The details of the user corresponding to the userid that is received" name="user" order="2" type="json"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_1n6t15u</bpmn2:incoming><bpmn2:outgoing>Flow_0lm1h9n</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.CustomRuleTask" id="isv_custom_rule_1693487621614_customId" name="Compute Login URL"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter displayName="Rule expression" id="inputData" instruction="Use functions and conditions to add or transform data" name="inputData" order="1" type="String">statements:
- context: &gt;
    userRealm := user['urn:ietf:params:scim:schemas:extension:ibm:2.0:User'].realm
- if:
    match: &gt;
        context.userRealm == "cloudIdentityRealm"
    block:
    - return: &gt;
        'https://' + ctx.__tenantid + '/authsvc/mtfim/sps/authsvc?PolicyId=urn:ibm:security:authentication:asf:basicldapuser'
    else:
    - return: &gt;
        'https://' + ctx.__tenantid + '/idaas/mtfim/sps/idaas/login/ibmid?identity_source_id=49335849-6852-4ec8-9b80-0e0d38ec7552'</isv:inputParameter><isv:outputParameter displayName="Script output" id="result" instruction="The response after executing the rule expression" name="result" order="2" type="String"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_10gg1vp</bpmn2:incoming><bpmn2:outgoing>Flow_1phtzht</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.RedirectTask" id="isv_redirect_1693487627874_customId" name="Login Page Redirect"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter displayName="URL" id="redirectUrl" instruction="The URL to redirect to." name="redirectUrl" order="2" type="String">${S(workflow_context).prop("result").value()}</isv:inputParameter><isv:inputParameter displayName="Signal(optional)" id="signal" instruction="Signal that an existing flow can use to come back and resume it's task." name="signal" order="3" type="String"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_1phtzht</bpmn2:incoming><bpmn2:outgoing>Flow_0j7k9ud</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:sequenceFlow id="Flow_1n6t15u" sourceRef="Event_0vtdtpv_customId" targetRef="isv_fetch_user_1693487617442_customId"/><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.RenderHTMLTask" id="isv_page_1700980002000_customId" name="Error Page"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter attrDisplayText="themeRegistrations.name" attrId="themeRegistrations.id" defaultValue="default" displayName="Theme" endpoint="/v1.0/branding/themes" id="themeId" inputType="SingleSelect" instruction="Name of the theme to render" method="GET" name="themeId" order="1" placeholder="Select a theme" required="true" type="String">c5fdcfd2-6558-4be8-80ba-915b9a1ac2c9</isv:inputParameter><isv:inputParameter attrDisplayText="templateList.name" attrId="templateList.name" defaultValue="custom_page1" displayName="Template name" endpoint="/bpm-mgmt/v1.0/customtask/util/templateList" id="templatename" inputType="SingleSelect" instruction="Name of the template to render" method="GET" name="templateName" order="2" placeholder="Select a template" required="true" type="String">custom_page5</isv:inputParameter><isv:inputParameter displayName="Signal(optional)" id="signal" instruction="Signal can be used to resume the task in an existing flow. To return to the existing flow after execution of the task, specify a signal value and ensure that a message event is configured after the task, with the same Signal value." name="signal" order="3" type="String"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_0wfnfax</bpmn2:incoming><bpmn2:outgoing>Flow_14jmad3</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:exclusiveGateway default="Flow_10gg1vp" id="Gateway_177mw4a_customId"><bpmn2:incoming>Flow_0lm1h9n</bpmn2:incoming><bpmn2:outgoing>Flow_0wfnfax</bpmn2:outgoing><bpmn2:outgoing>Flow_10gg1vp</bpmn2:outgoing></bpmn2:exclusiveGateway><bpmn2:sequenceFlow id="Flow_0wfnfax" name="User does not exist" sourceRef="Gateway_177mw4a_customId" targetRef="isv_page_1700980002000_customId"><bpmn2:conditionExpression xsi:type="bpmn2:tFormalExpression">${S(workflow_context).hasProp("error") &amp;&amp; S(workflow_context).prop("error").prop("messageId").stringValue() == "CSIBZ1023E"}</bpmn2:conditionExpression></bpmn2:sequenceFlow><bpmn2:sequenceFlow id="Flow_14jmad3" sourceRef="isv_page_1700980002000_customId" targetRef="Event_0fzzuo8_customId"/><bpmn2:sequenceFlow id="Flow_0lm1h9n" sourceRef="isv_fetch_user_1693487617442_customId" targetRef="Gateway_177mw4a_customId"/><bpmn2:sequenceFlow id="Flow_10gg1vp" name="User exists" sourceRef="Gateway_177mw4a_customId" targetRef="isv_custom_rule_1693487621614_customId"/><bpmn2:sequenceFlow id="Flow_1phtzht" sourceRef="isv_custom_rule_1693487621614_customId" targetRef="isv_redirect_1693487627874_customId"/><bpmn2:sequenceFlow id="Flow_0j7k9ud" sourceRef="isv_redirect_1693487627874_customId" targetRef="Event_0fzzuo8_customId"/></bpmn2:process><bpmn2:message id="Message_08k7kfh" name="ifa"/><bpmn2:message id="Message_17apt1g" name="errorCondition"/><bpmn2:message id="Message_16zu7nh" name="errorCondition"/><bpmn2:message id="Message_18zyrh4" name=""/><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane bpmnElement="identity_source_routing" id="BPMNPlane_1"><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="Event_0onayf9" color:border-color="#161616" id="Event_0onayf9_di"><dc:Bounds height="36" width="36" x="152" y="82"/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_render_html_1693487581300_customId" color:border-color="#161616" id="Activity_1cb2gm9_di"><dc:Bounds height="76" width="188" x="226" y="62"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="Event_0vtdtpv_customId" color:border-color="#161616" id="Event_0vtdtpv_di"><dc:Bounds height="36" width="36" x="302" y="182"/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="Event_0fzzuo8_customId" color:border-color="#161616" id="Event_0fzzuo8_di"><dc:Bounds height="36" width="36" x="192" y="752"/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_fetch_user_1693487617442_customId" color:border-color="#161616" id="Activity_09snln6_di"><dc:Bounds height="76" width="188" x="226" y="260"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#175ffe" bpmnElement="isv_custom_rule_1693487621614_customId" color:border-color="#175ffe" id="Activity_06fobbt_di"><dc:Bounds height="76" width="188" x="226" y="512"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_redirect_1693487627874_customId" color:border-color="#161616" id="Activity_0wiw6z3_di"><dc:Bounds height="76" width="188" x="226" y="632"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_page_1700980002000_customId" color:border-color="#161616" id="Activity_0mk1z30_di"><dc:Bounds height="76" width="188" x="6" y="572"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="Gateway_177mw4a_customId" color:border-color="#161616" id="Gateway_177mw4a_di" isMarkerVisible="true"><dc:Bounds height="50" width="50" x="295" y="395"/></bpmndi:BPMNShape><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_1w02h0s" color:border-color="#161616" id="Flow_1w02h0s_di"><di:waypoint x="188" y="100"/><di:waypoint x="226" y="100"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0x5fq5m" color:border-color="#161616" id="Flow_0x5fq5m_di"><di:waypoint x="320" y="138"/><di:waypoint x="320" y="182"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_1n6t15u" color:border-color="#161616" id="Flow_1n6t15u_di"><di:waypoint x="320" y="218"/><di:waypoint x="320" y="260"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0wfnfax" color:border-color="#161616" id="Flow_0wfnfax_di"><di:waypoint x="295" y="420"/><di:waypoint x="100" y="420"/><di:waypoint x="100" y="572"/><bpmndi:BPMNLabel color:color="#161616"><dc:Bounds height="32" width="84" x="165" y="402"/></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_14jmad3" color:border-color="#161616" id="Flow_14jmad3_di"><di:waypoint x="100" y="648"/><di:waypoint x="100" y="770"/><di:waypoint x="192" y="770"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0lm1h9n" color:border-color="#161616" id="Flow_0lm1h9n_di"><di:waypoint x="320" y="336"/><di:waypoint x="320" y="395"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_10gg1vp" color:border-color="#161616" id="Flow_10gg1vp_di"><di:waypoint x="320" y="445"/><di:waypoint x="320" y="512"/><bpmndi:BPMNLabel color:color="#161616"><dc:Bounds height="16" width="68" x="326" y="462"/></bpmndi:BPMNLabel></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_1phtzht" color:border-color="#161616" id="Flow_1phtzht_di"><di:waypoint x="320" y="588"/><di:waypoint x="320" y="632"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0j7k9ud" color:border-color="#161616" id="Flow_0j7k9ud_di"><di:waypoint x="320" y="710"/><di:waypoint x="320" y="770"/><di:waypoint x="228" y="770"/></bpmndi:BPMNEdge></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn2:definitions>