<?xml version="1.0" encoding="UTF-8"?><bpmn2:definitions xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" exporter="Camunda Modeler" exporterVersion="5.0.0" id="_FXeIoKhnEeOC4LOKh_69JQ" targetNamespace="isv_customtasks" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:isv="http://ibm.com/bpmn/isv" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd"><bpmn2:process camunda:historyTimeToLive="1" id="ldap2okta" isExecutable="true" name="Migration from LDAP to Okta"><bpmn2:startEvent id="Event_0onayf9"><bpmn2:outgoing>Flow_0fwitsq</bpmn2:outgoing></bpmn2:startEvent><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.RenderHTMLTask" id="isv_render_html_1697696636038_customId" name="Ask for username"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter attrDisplayText="themeRegistrations.name" attrId="themeRegistrations.id" defaultValue="default" displayName="Theme" endpoint="/v1.0/branding/themes" id="themeId" inputType="SingleSelect" instruction="Name of the theme to render" method="GET" name="themeId" order="1" placeholder="Select a theme" required="true" type="String">79583aae-cc4e-4048-9866-1491a1772203</isv:inputParameter><isv:inputParameter attrDisplayText="templateList.name" attrId="templateList.name" defaultValue="custom_page1" displayName="Template name" endpoint="/bpm-mgmt/v1.0/customtask/util/templateList" id="templatename" inputType="SingleSelect" instruction="Name of the template to render" method="GET" name="templateName" order="2" placeholder="Select a template" required="true" type="String">custom_page1</isv:inputParameter><isv:inputParameter displayName="Signal(optional)" id="signal" instruction="Signal that an existing flow can use to come back and resume it's task." name="signal" order="3" type="String">onUsernameSubmitted</isv:inputParameter></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_1s17bl7</bpmn2:incoming><bpmn2:outgoing>Flow_0ss8wy1</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:sequenceFlow id="Flow_0fwitsq" sourceRef="Event_0onayf9" targetRef="isv_function_1700885828231_customId"/><bpmn2:intermediateCatchEvent id="Event_16ydly6_customId"><bpmn2:incoming>Flow_0ss8wy1</bpmn2:incoming><bpmn2:outgoing>Flow_0kcz593</bpmn2:outgoing><bpmn2:messageEventDefinition id="MessageEventDefinition_0wniaf0" messageRef="Message_0grgym4"/></bpmn2:intermediateCatchEvent><bpmn2:sequenceFlow id="Flow_0ss8wy1" sourceRef="isv_render_html_1697696636038_customId" targetRef="Event_16ydly6_customId"/><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.FetchUserTask" id="isv_fetch_user_1697696698558_customId" name="Fetch user"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter displayName="User name" id="userid" instruction="Name of the user to search on" name="userid" order="1" type="String">${S(workflow_context).prop("username").stringValue()}</isv:inputParameter><isv:outputParameter displayName="User details" id="user" instruction="The details of the user corresponding to the userid that is received" name="user" order="2" type="json"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_0kcz593</bpmn2:incoming><bpmn2:outgoing>Flow_19sh4x9</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:sequenceFlow id="Flow_0kcz593" sourceRef="Event_16ydly6_customId" targetRef="isv_fetch_user_1697696698558_customId"/><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.CustomRuleTask" id="isv_custom_rule_1697696726396_customId" name="Resolve IdP"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter displayName="Rule expression" id="inputData" instruction="Use functions and conditions to add or transform data" name="inputData" order="1" type="String">    statements:
- context: "theme := has(ctx.themeId) ? ctx.themeId : ''"
- context: "identitySourceIds := has(ctx.identity_source_ids) ? ctx.identity_source_ids : ''"
- context: "postUrl := has(ctx.Target) &amp;&amp; ctx.Target != '' ? ctx.Target : 'https://' + ctx.__tenantid + '/usc'"
- context: "realm := user != null &amp;&amp; user.getCustomValue('migratedToOkta') == 'true' ? ctx.okta_tenant : ctx.onprem_realm"
- return: &gt;
    {
        'loginUrl': 'https://' + ctx.__tenantid + '/idaas/mtfim/sps/idaas/login?runtime=true&amp;login_hint=' + ctx.username + '&amp;realm_hint=' + context.realm + '&amp;themeId=' + context.theme + '&amp;identity_source_ids=' + context.identitySourceIds,
        "post_url": context.postUrl,
        'realm': context.realm
        
    }</isv:inputParameter><isv:outputParameter displayName="Script output" id="result" instruction="The response after executing the rule expression" name="result" order="2" type="String"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_0dpl1ob</bpmn2:incoming><bpmn2:outgoing>Flow_0qbso81</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.RedirectTask" id="isv_redirect_1697696974029_customId" name="User authentication"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter displayName="URL" id="redirectUrl" instruction="The URL to redirect to." name="redirectUrl" order="2" type="String">${S(workflow_context).prop("loginUrl").stringValue()}&amp;Target=${S(workflow_context).prop("post_url").stringValue()}</isv:inputParameter><isv:inputParameter displayName="Signal(optional)" id="signal" instruction="Signal that an existing flow can use to come back and resume it's task." name="signal" order="3" type="String"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_0qbso81</bpmn2:incoming><bpmn2:outgoing>Flow_04cbtnr</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:sequenceFlow id="Flow_0qbso81" sourceRef="isv_custom_rule_1697696726396_customId" targetRef="isv_redirect_1697696974029_customId"/><bpmn2:sequenceFlow id="Flow_04cbtnr" sourceRef="isv_redirect_1697696974029_customId" targetRef="Event_0z486zv_customId"/><bpmn2:endEvent id="Event_0z486zv_customId"><bpmn2:incoming>Flow_04cbtnr</bpmn2:incoming><bpmn2:incoming>Flow_0eo3byx</bpmn2:incoming></bpmn2:endEvent><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.CustomRuleTask" id="isv_function_1700885828231_customId" name="SetVars"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter displayName="Rule expression" id="inputData" instruction="Use functions and conditions to add or transform data" name="inputData" order="1" required="true" type="String">{
"okta_tenant" : "https://dev-99627789-admin.okta.com" ,
"onprem_realm" : "dune.com"
}</isv:inputParameter><isv:outputParameter displayName="Script output" id="result" instruction="The response after executing the rule expression" name="result" order="2" type="String"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_0fwitsq</bpmn2:incoming><bpmn2:outgoing>Flow_1s17bl7</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:sequenceFlow id="Flow_1s17bl7" sourceRef="isv_function_1700885828231_customId" targetRef="isv_render_html_1697696636038_customId"/><bpmn2:exclusiveGateway default="Flow_0dpl1ob" id="Gateway_1leq78m_customId"><bpmn2:incoming>Flow_19sh4x9</bpmn2:incoming><bpmn2:outgoing>Flow_0dpl1ob</bpmn2:outgoing><bpmn2:outgoing>Flow_02tuiu4</bpmn2:outgoing></bpmn2:exclusiveGateway><bpmn2:sequenceFlow id="Flow_19sh4x9" sourceRef="isv_fetch_user_1697696698558_customId" targetRef="Gateway_1leq78m_customId"/><bpmn2:sequenceFlow id="Flow_0dpl1ob" sourceRef="Gateway_1leq78m_customId" targetRef="isv_custom_rule_1697696726396_customId"/><bpmn2:serviceTask camunda:class="com.ibm.security.access.workflow.camunda.customTaskListener.RenderHTMLTask" id="isv_page_1701141519155_customId" name="Error Page"><bpmn2:extensionElements><isv:inputOutput><isv:inputParameter attrDisplayText="themeRegistrations.name" attrId="themeRegistrations.id" defaultValue="default" displayName="Theme" endpoint="/v1.0/branding/themes" id="themeId" inputType="SingleSelect" instruction="Name of the theme to render" method="GET" name="themeId" order="1" placeholder="Select a theme" required="true" type="String">79583aae-cc4e-4048-9866-1491a1772203</isv:inputParameter><isv:inputParameter attrDisplayText="templateList.name" attrId="templateList.name" defaultValue="custom_page1" displayName="Template name" endpoint="/bpm-mgmt/v1.0/customtask/util/templateList" id="templatename" inputType="SingleSelect" instruction="Name of the template to render" method="GET" name="templateName" order="2" placeholder="Select a template" required="true" type="String">custom_page2</isv:inputParameter><isv:inputParameter displayName="Signal(optional)" id="signal" instruction="Signal can be used to resume the task in an existing flow. To return to the existing flow after execution of the task, specify a signal value and ensure that a message event is configured after the task, with the same Signal value." name="signal" order="3" type="String"/></isv:inputOutput></bpmn2:extensionElements><bpmn2:incoming>Flow_02tuiu4</bpmn2:incoming><bpmn2:outgoing>Flow_0eo3byx</bpmn2:outgoing></bpmn2:serviceTask><bpmn2:sequenceFlow id="Flow_02tuiu4" sourceRef="Gateway_1leq78m_customId" targetRef="isv_page_1701141519155_customId"><bpmn2:conditionExpression xsi:type="bpmn2:tFormalExpression">${S(workflow_context).prop("username").stringValue() == " " }</bpmn2:conditionExpression></bpmn2:sequenceFlow><bpmn2:sequenceFlow id="Flow_0eo3byx" sourceRef="isv_page_1701141519155_customId" targetRef="Event_0z486zv_customId"/></bpmn2:process><bpmn2:message id="Message_0grgym4" name="onUsernameSubmitted"/><bpmn2:message id="Message_0qmucmb" name="onLogin"/><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane bpmnElement="ldap2okta" id="BPMNPlane_1"><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="Event_0onayf9" color:border-color="#161616" id="Event_0onayf9_di"><dc:Bounds height="36" width="36" x="152" y="-8"/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_render_html_1697696636038_customId" color:border-color="#161616" id="Activity_037t33w_di"><dc:Bounds height="76" width="188" x="76" y="222"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="Event_16ydly6_customId" color:border-color="#161616" id="Event_16ydly6_di"><dc:Bounds height="36" width="36" x="152" y="352"/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_fetch_user_1697696698558_customId" color:border-color="#161616" id="Activity_0k3anip_di"><dc:Bounds height="76" width="188" x="286" y="322"/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_custom_rule_1697696726396_customId" color:border-color="#161616" id="Activity_14hc4ln_di"><dc:Bounds height="76" width="188" x="756" y="322"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_redirect_1697696974029_customId" color:border-color="#161616" id="Activity_1i86hoq_di"><dc:Bounds height="76" width="188" x="756" y="482"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="Event_0z486zv_customId" color:border-color="#161616" id="Event_0z486zv_di"><dc:Bounds height="36" width="36" x="832" y="732"/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_function_1700885828231_customId" color:border-color="#161616" id="Activity_1nn6g7y_di"><dc:Bounds height="76" width="188" x="76" y="82"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="Gateway_1leq78m_customId" color:border-color="#161616" id="Gateway_1leq78m_di" isMarkerVisible="true"><dc:Bounds height="50" width="50" x="585" y="335"/></bpmndi:BPMNShape><bpmndi:BPMNShape bioc:stroke="#161616" bpmnElement="isv_page_1701141519155_customId" color:border-color="#161616" id="Activity_0akfdex_di"><dc:Bounds height="76" width="188" x="516" y="482"/><bpmndi:BPMNLabel/></bpmndi:BPMNShape><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0fwitsq" color:border-color="#161616" id="Flow_0fwitsq_di"><di:waypoint x="170" y="28"/><di:waypoint x="170" y="82"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0ss8wy1" color:border-color="#161616" id="Flow_0ss8wy1_di"><di:waypoint x="170" y="298"/><di:waypoint x="170" y="352"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0kcz593" color:border-color="#161616" id="Flow_0kcz593_di"><di:waypoint x="188" y="370"/><di:waypoint x="237" y="370"/><di:waypoint x="237" y="360"/><di:waypoint x="286" y="360"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0qbso81" color:border-color="#161616" id="Flow_0qbso81_di"><di:waypoint x="850" y="398"/><di:waypoint x="850" y="482"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_04cbtnr" color:border-color="#161616" id="Flow_04cbtnr_di"><di:waypoint x="850" y="558"/><di:waypoint x="850" y="732"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_1s17bl7" color:border-color="#161616" id="Flow_1s17bl7_di"><di:waypoint x="170" y="158"/><di:waypoint x="170" y="222"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_19sh4x9" color:border-color="#161616" id="Flow_19sh4x9_di"><di:waypoint x="474" y="360"/><di:waypoint x="585" y="360"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0dpl1ob" color:border-color="#161616" id="Flow_0dpl1ob_di"><di:waypoint x="635" y="360"/><di:waypoint x="756" y="360"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#175ffe" bpmnElement="Flow_02tuiu4" color:border-color="#175ffe" id="Flow_02tuiu4_di"><di:waypoint x="610" y="385"/><di:waypoint x="610" y="482"/></bpmndi:BPMNEdge><bpmndi:BPMNEdge bioc:stroke="#161616" bpmnElement="Flow_0eo3byx" color:border-color="#161616" id="Flow_0eo3byx_di"><di:waypoint x="610" y="558"/><di:waypoint x="610" y="750"/><di:waypoint x="832" y="750"/></bpmndi:BPMNEdge></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn2:definitions>