# app.yaml - IBM Security Verify Bulk User Import / Deletion Configuration Template
# ===============================================================================
# This file drives both bulk_loader.py (create/update) and bulk_deletion.py.
# 
# Required sections: tenant, auth, import
# Optional: delete, logging
#
# Security note:
#   - NEVER commit real client_secret or other secrets to version control
#   - Use environment variables, secrets manager, or .gitignore'd copy in production

tenant:
  base_url: "https://your-tenant.verify.ibm.com"      # ← REQUIRED: Your IBM Verify tenant base URL (no trailing /v2.0)
  scim_path: "/v2.0"                                  # Usually fixed; rarely changed

auth:
  client_id:     "your-client-id-here"                # ← REQUIRED: OAuth Client ID with manageUsers scope
  client_secret: "your-client-secret-here"            # ← REQUIRED: OAuth Client Secret (keep extremely secure!)
  token_path:    "/v1.0/endpoint/default/token"       # Usually correct for IBM Verify; confirm in your tenant

import:
  csv_file:   "data/upload.csv"                       # ← REQUIRED: Path to your CSV file (relative or absolute)
  batch_size: 200                                     # RECOMMENDED: 50–1000; start small (50–100) for testing

  # Attribute rules — define which SCIM attributes to set on every user
  # Rules are applied in order; later rules can override earlier ones
  attribute_rules:
    # ────────────────────────────────────────────────────────────────
    # Core SCIM attributes (no extension URN needed)
    # ────────────────────────────────────────────────────────────────
    - name: "active"                                  # Built-in: enables/disables user
      value: true
      type: static                                    # "static" = fixed value | "from_csv" = read from CSV
      csv_column: null                                # only used if type: from_csv

    # ────────────────────────────────────────────────────────────────
    # Custom / extension attributes (nested in IBM extension)
    # ────────────────────────────────────────────────────────────────
    - name: "registrationstatus"                      # Your tenant's custom attribute name (lowercase)
      value: "completed"
      type: static
      extension_urn: "urn:ietf:params:scim:schemas:extension:ibm:2.0:User"
      custom_container: "customAttributes"            # Nested array name in IBM extension
      custom_name_key: "name"                         # Key for attribute name inside each item
      custom_value_key: "values"                      # Key for value array (usually array even for single value)

    # Example: another custom attribute pulled from CSV column
    # - name: "employeeNumber"
    #   type: from_csv
    #   csv_column: "employee_id"                     # Must match a column header in CSV
    #   extension_urn: "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User"
    #   # No custom_container needed if it's a direct field (not nested)

    # Example: set a static department in enterprise extension
    # - name: "department"
    #   value: "Engineering"
    #   type: static
    #   extension_urn: "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User"

delete:
  dry_run: true                                       # REQUIRED for safety: set to false ONLY when ready to delete

logging:
  level: INFO                                         # DEBUG / INFO / WARNING / ERROR / CRITICAL
  format: "%(asctime)s  %(levelname)-8s  %(message)s"
  datefmt: "%Y-%m-%d %H:%M:%S"
  to_file: false                                      # Set true to also write to file
  file_path: "logs/bulk_operations.log"               # Only used if to_file: true
  file_mode: "a"                                      # "w" = overwrite each run, "a" = append